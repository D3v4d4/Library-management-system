{% extends 'bash.html' %}
{% load static %}

{% block title %}View Issued Books | Library Management System{% endblock %}

{% block body %}
<style>
  /* Fallback in case .btn-brand not defined in bash.html */
  .btn-brand{
    --bs-btn-padding-x: .8rem;
    --bs-btn-padding-y: .45rem;
    --bs-btn-font-weight: 600;
    --bs-btn-border-radius: 999px;
    --bs-btn-color:#fff;
    --bs-btn-bg: var(--brand-primary, #0ea5a4);
    --bs-btn-border-color: var(--brand-primary, #0ea5a4);
    --bs-btn-hover-color:#fff;
    --bs-btn-hover-bg: #0c8f8e;
    --bs-btn-hover-border-color:#0c8f8e;
    --bs-btn-active-color:#fff;
    --bs-btn-active-bg:#0b7f7e;
    --bs-btn-active-border-color:#0b7f7e;
    --bs-btn-focus-shadow-rgb: 14,165,164;
  }
</style>

<div class="container py-4">
  <div class="card shadow-sm border-0">
    <div class="card-header d-flex justify-content-between align-items-center"
         style="background: linear-gradient(90deg, var(--brand-bg, #0f172a), #111827); color:#fff;">
      <div class="d-flex align-items-center">
        <i class="fa-solid fa-book-open-reader me-2"></i>
        <h5 class="mb-0">View Issued Books</h5>
      </div>
      <div class="d-flex align-items-center">
        <div class="input-group input-group-sm" style="width:260px;">
          <span class="input-group-text bg-light"><i class="fa-solid fa-magnifying-glass"></i></span>
          <input id="tableSearch" type="text" class="form-control" placeholder="Search student or book...">
        </div>
      </div>
    </div>

    <div class="card-body p-0">
      <div class="table-responsive">
        <table id="issuedTable" class="table table-hover table-bordered align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:72px;">S.No.</th>
              <th><i class="fa-solid fa-user me-1"></i> Student</th>
              <th><i class="fa-solid fa-book me-1"></i> Book</th>
              <th><i class="fa-solid fa-pen-nib me-1"></i> Author</th>
              <th><i class="fa-regular fa-calendar-plus me-1"></i> Issue Date</th>
              <th><i class="fa-regular fa-calendar-xmark me-1"></i> Expiry Date</th>
              <th style="width:110px;"><i class="fa-solid fa-receipt me-1"></i> Action</th>
            </tr>
          </thead>
          <tbody>
            {% for i in data1 %}
            <tr>
              <td class="text-center">{{ forloop.counter }}</td>
              <td>{{ i.studentinfo.user.username }}</td>
              <td class="fw-semibold">{{ i.book.book_name }}</td>
              <td>{{ i.book.author }}</td>
              <td>{{ i.issue_date|date:"M d, Y" }}</td>
              <td>{{ i.expiry_date|date:"M d, Y" }}</td>
              <td class="text-center">
                <a href="{% url 'fine2' i.id %}" class="btn btn-sm btn-brand">
                  <i class="fa-solid fa-indian-rupee-sign me-1"></i> Fine
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center py-4 text-muted">
                <i class="fa-regular fa-face-frown me-1"></i> No issued books found.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  // Simple client-side filter (student/book)
  (function(){
    const input = document.getElementById('tableSearch');
    const table = document.getElementById('issuedTable');
    if(!input || !table) return;

    input.addEventListener('input', function(){
      const q = this.value.trim().toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const student = (row.children[1]?.textContent || '').toLowerCase();
        const book    = (row.children[2]?.textContent || '').toLowerCase();
        row.style.display = (student.includes(q) || book.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}
