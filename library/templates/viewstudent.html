
{% extends 'navigation.html' %}
{% load static %}
{% block title %}View Students | Library Management System{% endblock %}
{% block body %}
<style>
  .card-shell{ border:0; border-radius:18px; background:#fff; box-shadow:0 12px 30px rgba(2,6,23,.10); overflow:hidden; }
  .card-header-brand{
    background: linear-gradient(90deg, var(--brand-bg, #0f172a), #111827);
    color:#fff; padding:16px 20px;
  }
  .search-wrap .input-group-text{ background:#f3f4f6; }
  .search-wrap .form-control, .search-wrap .input-group-text{ border-radius:10px; }
  /* Fallback if .btn-brand not defined in base */
  .btn-brand{
    --bs-btn-padding-x:.8rem; --bs-btn-padding-y:.45rem; --bs-btn-font-weight:600; --bs-btn-border-radius:999px;
    --bs-btn-color:#fff; --bs-btn-bg: var(--brand-primary,#0ea5a4); --bs-btn-border-color: var(--brand-primary,#0ea5a4);
    --bs-btn-hover-color:#fff; --bs-btn-hover-bg:#0c8f8e; --bs-btn-hover-border-color:#0c8f8e;
  }
</style>

<div class="container py-4">
  <div class="card card-shell">
    <!-- Header -->
    <div class="card-header-brand d-flex flex-wrap align-items-center gap-2">
      <h5 class="mb-0"><i class="fa-solid fa-user-graduate me-2"></i> View Students</h5>
      <div class="ms-auto d-flex gap-2">
        <a href="{% url 'registerstudent' %}" class="btn btn-brand btn-sm">
          <i class="fa-solid fa-user-plus me-1"></i> Register Student
        </a>
      </div>
    </div>

    <!-- Controls -->
    <div class="card-body">
      <div class="row g-3 align-items-center justify-content-between mb-3">
        <div class="col-12 col-md-auto">
          <div class="input-group input-group-sm search-wrap" style="min-width:260px;">
            <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
            <input id="tableSearch" type="text" class="form-control" placeholder="Search by name, enrollment, branchâ€¦">
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table id="studentsTable" class="table table-hover table-bordered align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:80px;">S.N</th>
              <th><i class="fa-solid fa-user me-1"></i> First Name</th>
              <th><i class="fa-regular fa-user me-1"></i> Last Name</th>
              <th><i class="fa-solid fa-hashtag me-1"></i> Enrollment</th>
              <th><i class="fa-solid fa-diagram-project me-1"></i> Branch</th>
              <th style="width:170px;"><i class="fa-solid fa-wrench me-1"></i> Action</th>
            </tr>
          </thead>
          <tbody>
            {% for i in data1 %}
            <tr>
              <td class="text-center">{{ forloop.counter }}</td>
              <td>{{ i.user.first_name }}</td>
              <td>{{ i.user.last_name }}</td>
              <td class="fw-semibold">{{ i.rollNo }}</td>
              <td>{{ i.branch }}</td>
              <td class="text-center">
                <a href="{% url 'editstudent' i.id %}" class="btn btn-sm btn-secondary me-1">
                  <i class="fa-solid fa-pen-to-square"></i> Edit
                </a>
                <a href="{% url 'deletestudent' i.id %}" class="btn btn-sm btn-danger confirm-delete"
                   data-delete-url="{% url 'deletestudent' i.id %}">
                  <i class="fa-solid fa-trash"></i> Delete
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-4 text-muted">
                <i class="fa-regular fa-face-frown me-1"></i> No students found.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Client-side search -->
<script>
  (function(){
    const input = document.getElementById('tableSearch');
    const table = document.getElementById('studentsTable');
    if(!input || !table) return;

    input.addEventListener('input', function(){
      const q = this.value.trim().toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const first = (row.children[1]?.textContent || '').toLowerCase();
        const last  = (row.children[2]?.textContent || '').toLowerCase();
        const enroll= (row.children[3]?.textContent || '').toLowerCase();
        const br    = (row.children[4]?.textContent || '').toLowerCase();
        row.style.display = (first.includes(q) || last.includes(q) || enroll.includes(q) || br.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>

<!-- SweetAlert2: confirm before delete -->
<script>
  (function(){
    document.querySelectorAll('.confirm-delete').forEach(btn => {
      btn.addEventListener('click', function(e){
        e.preventDefault();
        const url = this.getAttribute('data-delete-url') || this.getAttribute('href');
        Swal.fire({
          icon:'warning',
          title:'Delete this student?',
          text:'This action cannot be undone.',
          showCancelButton:true,
          confirmButtonText:'Yes, delete',
          cancelButtonText:'Cancel'
        }).then(res => { if(res.isConfirmed){ window.location.href = url; } });
      });
    });
  })();
</script>

<!-- Optional: show Django messages as toasts -->
{% if messages %}
<script>
  (function(){
    const Toast = Swal.mixin({ toast:true, position:'top-end', showConfirmButton:false, timer:2200, timerProgressBar:true });
    {% for message in messages %}
      Toast.fire({ icon:'info', title:"{{ message|escapejs }}" });
    {% endfor %}
  })();
</script>
{% endif %}
{% endblock %}
